var t=require("debug"),e=require("util");function r(t){return t&&t.__esModule?t.default:t}function s(t,e,r,s){Object.defineProperty(t,e,{get:r,set:s,enumerable:!0,configurable:!0})}s(module.exports,"AttrsResolver",(()=>o)),s(module.exports,"AttrResolver",(()=>i));class o{debug;attrResolver;constructor(){this.debug=r(t)("AttrsResolver"),this.attrResolver=new i}isCode(t){return t.hasOwnProperty("type")&&("code"===t.type||"unbuf_code"===t.type)}isNotCode(t){return this.debug("isNotCode(): this=",this),!this.isCode(t)}resolve(t){if(!Array.isArray(t))throw new Error("AttrsResolver expects an array. Did you mean to call AttrResolver?");const s=t.filter(this.isCode).map((t=>t.val??"")).join("\n");return this.debug("code=",s),t.filter((t=>!this.isCode.call(this,t))).map((t=>{if(this.debug("start obj=",r(e).inspect(t,!1,10)),t.hasOwnProperty("attrs")){if(this.debug("obj has attrs"),!Array.isArray(t.attrs))throw new Error("attributes should be an array");this.debug("obj.attrs is array"),t.attrs=t.attrs.map((t=>this.attrResolver.resolve(t,s)))}return this.debug("end obj=",r(e).inspect(t,!1,10)),t}))}}class i{code;debug=r(t)("AttrResolver");constructor(t){this.code=t}resolve(t,s){if(this.debug("resolve(): obj=",r(e).inspect(t,!0,5)),this.debug("resolve(): typeof obj="+typeof t),Array.isArray(t))throw new Error("AttrResolver expects an object. Did you mean to call AttrsResolver?");t.hasOwnProperty("val")||(t.val=!0);try{const o=(t.code??"")+"\n"+(this.code??"")+"\n"+(s??""),i=Function(o+"; return "+t.val);this.debug("func=",i.toString());const a=i();this.debug("newAttrVal=",a),this.debug("typeof newAttrVal=",typeof a),r(e).types.isDate(a)?(this.debug("newAttrVal is a date"),t.val=a.toISOString()):a.hasOwnProperty("toString")?(this.debug("newAttrVal.hasOwnProperty()"),t.val=a.toString()):t.val="object"==typeof a?JSON.stringify(a):a,delete t.code}catch(t){console.error(t)}return t}}
//# sourceMappingURL=main.js.map
